{
  "hash": "4a4839aa96c4328eff515681b2802f7b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Two-Way ANOVA\"\nhighlight-style: solarized\n\nembed-resources: true\n\nexecute:\n  eval: false\n---\n\n```{=html}\n<style>\n.math.display .MathJax {\n  font-size: 95% !important;\n}\n</style>\n```\n\n\n::: {.cell}\n\n:::\n\n\nThompson, M., Lie, Y. & Green, S. (2023). Flexible structural equation modeling approaches for analyzing means. In R. Hoyle (Ed.), *Handbook of structural equation modeling* (2nd ed., pp. 385-408). New York, NY: Guilford Press.\n\n\nThis example shows the SEM approach to a two-way ANOVA. Results are reported in Tables 21.3 and 21.4 (pp. 395, 396).\n\nThe data file needs rearranging before it can be used: the format needs to be changed from \"long\" to \"wide\", and the Gender X Coping Strategy interaction needs a grouping variable set up.\n\n\n#### Load packages and get the data\n\nLoad the relevant packages, and run `satisfactionI.r` and `ANOVA_data.r` to get and rearrange the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lavaan)\nlibrary(DescTools)    # Cramer's V\n\nsource(\"satisfactionI.r\")\nhead(df)\n\nsource(\"ANOVA_data.r\")\nhead(df)\n```\n:::\n\n\nThe variables used in this example are:\n\n - x - Coping Strategy (\"a\" - no strategy; \"b\" - discussion; \"c\" - exercise)\n - g - Gender\n - y - dependent variable (\"after\" Life-Satisfaction scores)\n - sg - Gender X Coping Strategy interaction\n\n\n#### Preliminary results - Cramer's V\n\nOn page 394, TLG give Cramer's V for the Gender X Coping Strategy crosstabulation. As far as I know, Cramer's V is not available in base R, but **DescTools** is one of possibly many packages that has a function for Cramer's V.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDescTools::CramerV(df$g, df$x)\n```\n:::\n\n\nHowever, it is easy to calculate Cramer's V without the need for the extra package, given the formula:\n\n$$\n \\mathsf{Cramer's ~ V} = \\sqrt{\\frac{\\upchi^2 / n}{\\min(r-1, ~ c-1)}}\n$$\n\nwhere $n$ is the sample size, $r$ is the number of rows, and $c$ is the number of columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchisq <- unname(chisq.test(df$g, df$x)$statistic)\nn <- nrow(df)               # Sample size\nr <- length(unique(df$g))   # Number of rows\nc <- length(unique(df$x))   # Number of columns\n\nCV <- sqrt((chisq/n)/min(r-1, c-1)); CV\n```\n:::\n\n\nStandardised residuals will give the direction of the relationship (p. 394).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchisq.test(df$g, df$x)$stdres\n```\n:::\n\n\n\n#### Preliminary results - Gender X Coping Strategy crosstabulation\n\nTable 21.3 (p. 395) gives the cell means and frequecies, and the weighted and unweighted marginal means.\n\nGet the cell means and frequencies.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans <- with(df, tapply(y, list(g, x), mean)); means     # Cell means\nfreq  <- with(df, table(g, x)); freq                      # Cell frequencies\n```\n:::\n\n\nGet the unweighted and weighted marginal means.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Unweighted marginal means\napply(means, 1, mean)      # Gender\napply(means, 2, mean)      # Coping Strategy\n \n# Weighted marginal means\nwith(df, tapply(y, g, mean))     # Gender\nwith(df, tapply(y, x, mean))     # Coping Strategy\n```\n:::\n\n\n\n#### The models\n\nThe SEM model for two-way ANOVA is shown below. The diagram shows the \"Less Constrained\" model - the six means, represented by the label on the arrows connecting the \"1\" to the dependent variable, differ. To be consistent with the ANOVA assumption of homogeneity of variances, the residual variances are constrained to be equal.\n\n![](../../Drawing_SEMs/Green_2023/two_way_ANOVA.svg){fig-align=\"center\"}\n\nThe model statements are shown below. The \"Less Constrained\" model allows the means (represented by the labels, am, af, ..., cf) to differ across the groups. The constraints statements are added to the \"Less Constrained\" statement to give the \"More Constrained\" models. The \"More Constrained\" models are contrasted with the \"Less Constrained\" model to test for the Gender and Coping Strategy main effects (weighted and unweighted) and the Gender X Coping Strategy interaction. In each case the residual variances are constrained to equality.\n\nConstraint for the unweighted Gender main effect - Restrict the mean for males to equal the mean for females. But there are three means for females, one for each Coping Strategy group. Similarly, there are three means for males. Simply constrain the sum of the three means for males to equal the sum of the three means for females.\n\nConstraints for the unweighted Coping Strategy main effect - Restrict the mean for \"a\" strategy to equal the mean for \"b\" strategy to equal the mean for \"c\" strategy. That is, constrain the sum of the two \"a\" means to equal the sum of the two \"b\" means; and the sum of the two \"b\" means to equal the sum of the two \"c\" means.\n\nTo test for the main effects applied to weighted means, the constraints are set the same way as before except the means are weighted in proportion to the cell frequencies.\n\nConstraints for the Gender X Coping Strategy interaction - The \"More Constrained\" model needs the means to be constrained so that the difference between the mean for \"female\" and the mean for \"male\" remains constant across levels of \"Coping Strategy\". That is: the difference between \"female\" mean and \"male\" mean for the \"a\" strategy equals the difference between \"female\" mean and \"male\" mean for the \"b\" strategy; and the difference between \"female\" mean and \"male\" mean for the \"b\" strategy equals the difference between \"female\" mean and \"male\" mean for the \"c\" strategy.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Less Constrained model\nlc <- \"y ~  c(am, af, bm, bf, cm, cf)*1      # Means\n       y ~~ c(e, e, e, e, e, e)*y            # Variances\"\n\nlc.fit <- sem(lc, data = df, group = \"sg\")\nsummary(lc.fit)\n\n## Gender main effect - unweighted means\nconstraints <- \"af + bf + cf == am + bm + cm\"\ngend_unw <- c(lc, constraints)\n\ngend_unw.fit <- sem(gend_unw, data = df, group = \"sg\")\nsummary(gend_unw.fit)\n\nanova(gend_unw.fit, lc.fit)   # Compare the two models\n\n## Coping Strategy main effect - unweighted means\nconstraints <- \n  \"af + am == bf + bm \n   af + am == cf + cm\"\nstrat_unw <- c(lc, constraints)\n\nstrat_unw.fit <- sem(strat_unw, data = df, group = \"sg\")\nsummary(strat_unw.fit)\n\nanova(strat_unw.fit, lc.fit)   # Compare the two models\n\n## Gender main effect - weighted means\nfreq                     # To assist with constructing constraints\nconstraints <- \"(3*af + 3*bf + 6*cf)/12 == (6*am + 3*bm + 3*cm)/12\"\ngend_w <- c(lc, constraints)\n\ngend_w.fit <- sem(gend_w, data = df, group = \"sg\")\nsummary(gend_w.fit)\n\nanova(gend_w.fit, lc.fit)   # Compare the two models\n\n## Coping Strategy main effect - weighted means\n## Compare with SEM section in Table 21.4\nfreq\nconstraints <- \n  \"(3*af + 6*am)/9 == (3*bf + 3*bm)/6 \n   (3*bf + 3*bm)/6 == (6*cf + 3*cm)/9\"\nstrat_w <- c(lc, constraints)\n\nstrat_w.fit <- sem(strat_w, data = df, group = \"sg\")\nsummary(strat_w.fit)\n\nanova(strat_w.fit, lc.fit)   # Compare the two models\n\n## Gender X Coping Strategy interaction\nconstraints <- \n  \"(af - am) == (bf - bm)\n   (bf - bm) == (cf - cm)\"\ninter <- c(lc, constraints)\n\ninter.fit <- sem(inter, data = df, group = \"sg\")\nsummary(inter.fit)\n\nanova(inter.fit, lc.fit)     # Compare the two models\n```\n:::\n\n\n<br />\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R code with minimal commenting\"}\n## Two-way ANOVA\n##\n## Thompson, M., Lie, Y. & Green, S. (2023). Flexible structural equation modeling\n## approaches for analyzing means. In R. Hoyle (Ed.), Handbook of structural\n## equation modeling (2nd ed., pp. 385-408). New York, NY: Guilford Press.\n\n## Load packages\nlibrary(lavaan)\nlibrary(DescTools)    # Cramer's V\n\n## Get the data\nsource(\"satisfactionI.r\")\nhead(df)\n\n## Rearrange the data file\nsource(\"ANOVA_data.r\")\nhead(df)\n\n## Cramer's V\n## Check with page 394\nDescTools::CramerV(df$g, df$x)\n\n## Cramer's V by hand\nchisq <- unname(chisq.test(df$g, df$x)$statistic)\nn <- nrow(df)               # Sample size\nr <- length(unique(df$g))   # Number of rows\nc <- length(unique(df$x))   # Number of columns\n\nCV <- sqrt((chisq/n)/min(r-1, c-1)); CV\n\n## Direction of the relationship\nchisq.test(df$g, df$x)$stdres\n\n## Cell means and cell frequencies\n## Check cell means and frequencies in Table 21.3\nmeans <- with(df, tapply(y, list(g, x), mean)); means     # Cell means\nfreq  <- with(df, table(g, x)); freq                      # Cell frequencies\n\n## Check unweighted and weighted means in Table 21.3\n# Unweighted marginal means\napply(means, 1, mean)      # Gender\napply(means, 2, mean)      # Coping Strategy\n\n# Weighted marginal means\nwith(df, tapply(y, g, mean))     # Gender\nwith(df, tapply(y, x, mean))     # Coping Strategy\n\n## Less Constrained model\nlc <- \"y ~  c(am, af, bm, bf, cm, cf)*1      # Means\n       y ~~ c(e, e, e, e, e, e)*y            # Variances\"\n\nlc.fit <- sem(lc, data = df, group = \"sg\")\nsummary(lc.fit)\n\n## Gender main effect - unweighted means\nconstraints <- \"af + bf + cf == am + bm + cm\"\ngend_unw <- c(lc, constraints)\n\ngend_unw.fit <- sem(gend_unw, data = df, group = \"sg\")\nsummary(gend_unw.fit)\n\nanova(gend_unw.fit, lc.fit)   # Compare the two models\n\n## Coping Strategy main effect - unweighted means\nconstraints <-\n  \"af + am == bf + bm\n   af + am == cf + cm\"\nstrat_unw <- c(lc, constraints)\n\nstrat_unw.fit <- sem(strat_unw, data = df, group = \"sg\")\nsummary(strat_unw.fit)\n\nanova(strat_unw.fit, lc.fit)   # Compare the two models\n\n## Gender main effect - weighted means\nfreq                     # To assist with constructing constraints\nconstraints <- \"(3*af + 3*bf + 6*cf)/12 == (6*am + 3*bm + 3*cm)/12\"\ngend_w <- c(lc, constraints)\n\ngend_w.fit <- sem(gend_w, data = df, group = \"sg\")\nsummary(gend_w.fit)\n\nanova(gend_w.fit, lc.fit)   # Compare the two models\n\n## Coping Strategy main effect - weighted means\n## Compare with SEM section in Table 21.4\nfreq\nconstraints <-\n  \"(3*af + 6*am)/9 == (3*bf + 3*bm)/6\n   (3*bf + 3*bm)/6 == (6*cf + 3*cm)/9\"\nstrat_w <- c(lc, constraints)\n\nstrat_w.fit <- sem(strat_w, data = df, group = \"sg\")\nsummary(strat_w.fit)\n\nanova(strat_w.fit, lc.fit)   # Compare the two models\n\n## Gender X Coping Strategy interaction\nconstraints <-\n  \"(af - am) == (bf - bm)\n   (bf - bm) == (cf - cm)\"\ninter <- c(lc, constraints)\n\ninter.fit <- sem(inter, data = df, group = \"sg\")\nsummary(inter.fit)\n\nanova(inter.fit, lc.fit)     # Compare the two models\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R code to get data file - `satisfactionI.r`\"}\n### Data for Tables 21.1, 21.2, 21.3, 21.4 ###\n\ndf <- structure(list(x = c(\"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \n\"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"b\", \"b\", \"b\", \n\"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"c\", \"c\", \"c\", \"c\", \n\"c\", \"c\", \"c\", \"c\", \"c\", \"c\", \"c\", \"c\", \"c\", \"c\", \"c\", \"c\", \"c\", \n\"c\"), g = c(\"m\", \"m\", \"m\", \"m\", \"m\", \"m\", \"f\", \"f\", \"f\", \"m\", \n\"m\", \"m\", \"m\", \"m\", \"m\", \"f\", \"f\", \"f\", \"m\", \"m\", \"m\", \"f\", \"f\", \n\"f\", \"m\", \"m\", \"m\", \"f\", \"f\", \"f\", \"m\", \"m\", \"m\", \"f\", \"f\", \"f\", \n\"f\", \"f\", \"f\", \"m\", \"m\", \"m\", \"f\", \"f\", \"f\", \"f\", \"f\", \"f\"), \n    c = c(\"before\", \"before\", \"before\", \"before\", \"before\", \"before\", \n    \"before\", \"before\", \"before\", \"after\", \"after\", \"after\", \n    \"after\", \"after\", \"after\", \"after\", \"after\", \"after\", \"before\", \n    \"before\", \"before\", \"before\", \"before\", \"before\", \"after\", \n    \"after\", \"after\", \"after\", \"after\", \"after\", \"before\", \"before\", \n    \"before\", \"before\", \"before\", \"before\", \"before\", \"before\", \n    \"before\", \"after\", \"after\", \"after\", \"after\", \"after\", \"after\", \n    \"after\", \"after\", \"after\"), y = c(21, 19, 22, 21, 24, 23, \n    21, 24, 23, 22, 22, 24, 25, 27, 30, 22, 23, 24, 23, 23, 21, \n    19, 22, 21, 30, 26, 22, 25, 26, 27, 27, 25, 24, 25, 23, 22, \n    23, 28, 26, 34, 30, 26, 26, 27, 28, 29, 40, 42)), class = \"data.frame\", row.names = c(NA, \n-48L))\n\n\nhead(df)\n\n## x - Coping Strategy (a - No strategy; b - Discussion; c - Exercise)\n## g - Gender\n## c - before/after \n## y - dependent variable (Life Satisfaction)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R code to rearrange data file - `ANOVA_data.r`\"}\n### Data for Tables 21.1, 21.2, 21.3, 21.4 ###\n\n## Reshape data - long to wide\ntab <- 0.5 * table(df$x)  # in each condition\ndf$id <- c(rep(1:tab[1], 2), rep(1:tab[2], 2), rep(1:tab[3], 2))  # id variable \n\ndf <- reshape(df, timevar = \"c\", idvar = c(\"id\", \"x\", \"g\"), varying = c(\"pre\", \"y\"), \n   direction = \"wide\")\n\ndf <- within(df, {\n## Grand mean centered \"pre\" - the before scores\n   preC <- scale(pre, scale = FALSE)\n\n## Drop the id variable\n   id <- NULL\n\n## Gender X Coping Strategy interaction\n  sg <- interaction(x, g, sep = \"\")\n})\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}